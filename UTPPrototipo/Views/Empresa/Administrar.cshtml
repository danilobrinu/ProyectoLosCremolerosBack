@*@model UTP.PortalEmpleabilidad.Modelo.Empresa*@

@{
    Layout = "~/Views/Empresa/_LayoutEmpresa.cshtml";
    ViewBag.Title = "Admnistrar el registro de la Empresa";
}

<div class="container" style="margin-top:2px;">

    <!--Panel superior donde se muestra los datos del usuario autenticado. - Ancho 12-->
    @{Html.RenderAction("VistaCabecera", "Empresa");}

    <div class ="row">
        <div id="divAdministrarImagen" class ="col-sm-4">
            @Html.Action("_AdministrarImagen", "Empresa", new { IdEmpresa = @ViewBag.IdEmpresa })
        </div>
        <div class="col-sm-8">
            <!--Panel de datos generales de la emrpesa - Ancho 12-->
            @Html.Action("_AdministrarDatosGenerales", "Empresa", new { IdEmpresa = @ViewBag.IdEmpresa })
        </div>
    </div>

    <div class="row fuente-pequeña">

        <!--Columna de Ubicaciones - Ancho 6-->
        <div id="divListaUbicaciones" class="col-sm-6">
            @Html.Action("_AdministrarUbicaciones", "Empresa", new { IdEmpresa = @ViewBag.IdEmpresa })
        </div>

        <!--Columna de Usuarios - Ancho 6-->
        <div id="divListaUsuarios" class="col-sm-6">
            @Html.Action("_AdministrarUsuarios", "Empresa", new { IdEmpresa = @ViewBag.IdEmpresa })
        </div>

     </div>

</div>

@*<div id="divCargando">
    <img id="imgCargando" src="../../img/cargando.gif" alt="" />
</div>*@

<!--
    id="Modal-modifica-datos-empresa"
-->

<!-- Modal Datos Generales -->
<div id="divEditarModal" class="modal"  tabindex="-1" role="dialog" aria-labelledby="ModificaDatosEmpresa" aria-hidden="true">

    @using (Ajax.BeginForm("EditarEmpresa", "Empresa", new AjaxOptions() {  LoadingElementId = "divCargando", InsertionMode = InsertionMode.Replace, HttpMethod = "POST", UpdateTargetId = "datos-empresa", OnComplete = "cerrarModal" }))
    {
        @Html.AntiForgeryToken()

        <div id="divEditarContenedor" class="modal-dialog">

        </div>
    }

</div>

<!-- Modal Ubicaciones-->
<div id="divModalNuevaUbicacion" class="modal" tabindex="-1" role="dialog" aria-labelledby="NuevaUbicacion" aria-hidden="true">

    @using (Ajax.BeginForm("_AdministrarNuevaUbicacion", "Empresa", new AjaxOptions() { InsertionMode = InsertionMode.Replace, HttpMethod = "POST", UpdateTargetId = "divListaUbicaciones", OnComplete = "cerrarModal" }))
    {    
        @Html.AntiForgeryToken()
        
        <div id="divNuevaUbicacionContenedor" class="modal-dialog">

        </div>
    
    }
</div>

<div id="divModalUbicacionEditar" class="modal" tabindex="-1" role="dialog" aria-labelledby="EditarUbicacion" aria-hidden="true">

    @using (Ajax.BeginForm("_AdministrarUbicacionEditar", "Empresa", new AjaxOptions() { InsertionMode = InsertionMode.Replace, HttpMethod = "POST", UpdateTargetId = "divListaUbicaciones", OnComplete = "cerrarModal" }))
    {
        @Html.AntiForgeryToken()

        <div id="divUbicacionContenedorEditar" class="modal-dialog">

        </div>

    }
</div>

<!-- Modal Usuarios-->
<!--Crear usuario-->
<div class="modal" id="divModalNuevoUsuario" tabindex="-1" role="dialog" aria-labelledby="NuevaUbicacion" aria-hidden="true">

    @using (Ajax.BeginForm("_AdministrarNuevoUsuario", "Empresa", new AjaxOptions() {  InsertionMode = InsertionMode.Replace, HttpMethod = "POST", UpdateTargetId = "divListaUsuarios", OnComplete = "cerrarModal" }))
    {
        @Html.AntiForgeryToken()
       
        <div id="divNuevoUsuarioContenedor" class="modal-dialog">

        </div>    
    }
</div>

<!--Editar usuario-->
<div class="modal" id="divModalUsuarioEditar" tabindex="-1" role="dialog" aria-labelledby="EditarUbicacion" aria-hidden="true">

    @using (Ajax.BeginForm("_AdministrarUsuarioEditar", "Empresa", new AjaxOptions() { InsertionMode = InsertionMode.Replace, HttpMethod = "POST", UpdateTargetId = "divListaUsuarios", OnComplete = "cerrarModal" }))
    {
        @Html.AntiForgeryToken()

        <div id="divUsuarioContenedorEditar" class="modal-dialog">

        </div>
    }
</div>


@*<script src="~/Scripts/jquery.unobtrusive-ajax.js"></script>
<script src="~/Scripts/jquery.validate.min.js"></script>
<script src="~/Scripts/jquery.validate.unobtrusive.min.js"></script>*@

<script>
    $(document).ready(function () {
        $("#divFinalCabeceraEmpresa").removeClass("color-paleta1 color-paleta2 color-paleta3 color-paleta5").addClass("color-paleta4");

        //$('#btnModificarEmpresa').on("click", function () {
        //    //debugger;
        //    var url = "/Empresa/EditarEmpresa"; // el url del controlador
        //    var id = $(this).attr('data-id'); // el id del botón.
        //    $.get(url + '/' + id, function (data) {
        //        $('#divEditarContenedor').html(data);

        //        //var formSelector = $('#divEditarModal').find('form');
        //        //var form = $(formSelector)
        //        //                .removeData("validator") /* added by the raw jquery.validate plugin */
        //        //                .removeData("unobtrusiveValidation");

        //        $.validator.unobtrusive.parse('#divEditarContenedor');
        //        //$.validator.unobtrusive.parse('#divEditarModal');

        //        $('#divEditarModal').modal('show');

        //    });
        //});
       
    });

    function modificarEmpresa(id) {
        var url = "/Empresa/EditarEmpresa"; // el url del controlador
        //alert(id);
        //var id = $(this).attr('data-id'); // el id del botón.
        $.get(url + '/' + id, function (data) {
            $('#divEditarContenedor').html(data);

            //var formSelector = $('#divEditarModal').find('form');
            //var form = $(formSelector)
            //                .removeData("validator") /* added by the raw jquery.validate plugin */
            //                .removeData("unobtrusiveValidation");

            $.validator.unobtrusive.parse('#divEditarContenedor');
            //$.validator.unobtrusive.parse('#divEditarModal');

            $('#divEditarModal').modal('show');

        });
    }

    function crearUsuario() {
        var url = "/Empresa/_AdministrarNuevoUsuario"; // el url del controlador           
        $.get(url, function (data) {
            $('#divNuevoUsuarioContenedor').html(data);
            $.validator.unobtrusive.parse('#divNuevoUsuarioContenedor');

            $('#divModalNuevoUsuario').modal('show');
        });
    }

    function editarUsuario(id) {
        var url = "/Empresa/_AdministrarUsuarioEditar/" + id;
        $.get(url, function (data) {
            $('#divUsuarioContenedorEditar').html(data);
            $.validator.unobtrusive.parse('#divUsuarioContenedorEditar');
            $('#divModalUsuarioEditar').modal('show');
        });
    }

    function crearLocacion()
    {
        var url = "/Empresa/_AdministrarNuevaUbicacion"; // el url del controlador            
        $.get(url, function (data) {
            //alert(data);
            $('#divNuevaUbicacionContenedor').html(data);
            $.validator.unobtrusive.parse('#divNuevaUbicacionContenedor');
            $('#divModalNuevaUbicacion').modal('show');
        }).error(function (err) { console.log(err); });
    }

    function editarLocacion(id) {
        var url = "/Empresa/_AdministrarUbicacionEditar/" + id; // el url del controlador            
        $.get(url, function (data) {            
            $('#divUbicacionContenedorEditar').html(data);
            $.validator.unobtrusive.parse('#divUbicacionContenedorEditar');
            $('#divModalUbicacionEditar').modal('show');
        }).error(function (err) { console.log(err); });
    }

    function cerrarModal() {      
        $('.modal.in').modal('hide');
    }

    //function validar() {
    //    debugger;
    //    //var form = $('#divEditarModal').find('form');

    //    //var validacion = $(form).validate();
    //    var esValido = $('#form0').valid();
        
    //    if (esValido)
    //    {
    //        return true;
    //    }
    //    else
    //    {
    //        return false;
    //    }

    //}

</script>



