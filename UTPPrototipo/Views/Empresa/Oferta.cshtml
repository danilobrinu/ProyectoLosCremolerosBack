@model UTP.PortalEmpleabilidad.Modelo.Oferta
@using UTP.PortalEmpleabilidad.Modelo

@{
    Layout = "~/Views/Empresa/_LayoutEmpresa.cshtml";
    ViewBag.Title = "Oferta Laboral";   
}

<input id="hddIdOferta" type="hidden" value="@Model.IdOferta" />
@Html.HiddenFor(m => m.IdOferta)
<div class="container" style="margin-top:2px;">

    @{Html.RenderAction("VistaCabecera", "Empresa");}


    <div class="row">
        <div class="col-md-7">

             <div class="panel-group" id="oferta-anuncio" role="tablist" aria-multiselectable="true">
                @Html.Action("VistaOfertaAnuncio", "Empresa", new { oferta = @Model})
             </div>

             <div class="panel-group" id="divContenedorPostulantes" role="tablist" aria-multiselectable="true">
                @using (Ajax.BeginForm("_OfertaPostulanteMoverDeFase", "Empresa", new AjaxOptions() { InsertionMode = InsertionMode.Replace, HttpMethod = "POST", UpdateTargetId = "divActualizarPostulantes", OnComplete = "alertaExito" }))
                {
                    @Html.AntiForgeryToken()

                    <div id="divActualizarPostulantes">
                        @Html.Action("VistaOfertaPostulantes", "Empresa", new { id = @Model.IdOferta, estado = @Model.EstadoOferta })
                    </div>
                }
             </div>
          </div>

        <div class="col-md-5">

            <div class="panel-group" id="oferta-condiciones" role="tablist" aria-multiselectable="true">
                @Html.Action("VistaOfertaCondiciones", "Empresa", new { oferta = @Model })
            </div>
            <div class="panel-group" id="oferta-requisito" role="tablist" aria-multiselectable="true">
                @Html.Action("VistaOfertaRequisitos", "Empresa", new { oferta = @Model })
            </div>
            @*<div class="panel-group" id="divOfertaMensajes" role="tablist" aria-multiselectable="true">
                @Html.Action("_ObtenerMensajes", "Mensaje", new { id = @Model.IdOferta })
            </div>*@
            <div class="panel-group" role="tablist" aria-multiselectable="true" id="divListaMensajes">
                <!--Se envía el parámetro para distinguir el funcionamiento de cada página. [{MODULO}_{PAGINA}]-->
                @Html.Action("_Mensajes", "Mensaje", new { pantalla = Constantes.MENSAJES_EMPRESA_OFERTA, idOferta = Model.IdOferta })
            </div>
        </div>
    </div>
</div>
<script>
    $(document).ready(function () {
        $("#divFinalCabeceraEmpresa").removeClass("color-paleta1 color-paleta3 color-paleta4 color-paleta5").addClass("color-paleta2");


        $('#colFecha').on('click', function () {
            debugger;
            console.log('click en colFecha');
            
            //Se obtiene el Id y el estado:
            var idOferta = $('#hddIdOferta').val();
            var estadoOferta = $('#hddEstadoOfertaIdListaValor').val();
            var columnActual = $('#hddColumnaActual').val();
            var ordenActual = $('#hddOrdenActual').val();

            var orden = ordenActual == 'ASC' ? 'DESC' : 'ASC';

            //Se llama al controlador pasando los parámetros para ordenar las columnas.
            var url = '@Url.Action("VistaOfertaPostulantes", "Empresa")' + '?id=' + idOferta + '&columna=Fecha&orden=' + orden + '&estado=' + estadoOferta;
            $.get(url, function (data) {
                $('#divActualizarPostulantes').html(data);
            });

        });

    });

    function alertaExito() {
        alert('Los postulantes cambiaron de fase con éxito');
    }
</script>