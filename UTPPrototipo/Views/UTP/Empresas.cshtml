@*@model IEnumerable<UTP.PortalEmpleabilidad.Modelo.Vistas.Ofertas.VistaEmpresListarOfertas>*@

@model UTP.PortalEmpleabilidad.Modelo.Vistas.Ofertas.VistaEmpresListarOfertas

@{
    Layout = "~/Views/UTP/_LayoutUTP.cshtml";
    ViewBag.Title = "Empresas";
}
<link href="~/Content/font-awesome.css" rel="stylesheet" />
@using (Html.BeginForm())
{

    <div class="container" style="margin-top:2px;">
        <div class="panel-group" id="datos-cuenta" role="tablist" aria-multiselectable="true">

            @{Html.RenderAction("VistaCabeceraUtp", "UTP");}

        </div>
        <div class="panel-group" id="CriterioBusquedaPostulacion" role="tablist" aria-multiselectable="true">
            <div class="panel panel-default">
                <div class="panel-heading" role="tab" id="CabeceraColapsaBusqueda" style="padding: 2px 2px 2px 6px;">
                    <h5 class="panel-title">
                        <a data-toggle="collapse" data-parent="#CriterioBusquedaPostulacion" href="#ColapsaBusqueda" aria-expanded="true" aria-controls="ColapsaBusqueda" class="fuente-seccion">
                            Búsqueda
                        </a>
                    </h5>
                </div>
                <div id="ColapsaBusqueda" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="CabeceraColapsaBusqueda">
                    <div class="panel-body">
                        <table style="width:100%;">
                            <tr>
                                <td>
                                    <div class="input-group fuente-pequeña">
                                        <span class="input-group-addon fuente-pequeña">Palabra Clave</span>
                                        @Html.TextBoxFor(model => model.PalabraClave, new { @class = "form-control", @placeholder = "Nombre" })

                                    </div>
                                </td>
                                <td style="text-align:right;">
                                    <span class="col-md-6 btn-group">
                                        <span class="fui" style=" font-size:30px;cursor:pointer" id="buscar">(</span>
                                    </span>
                                </td>
                            </tr>
                        </table>
                    
                    </div>
                </div>
            </div>
            <div class="panel panel-default">
                <div class="panel-heading" role="tab" id="CabeceraColapsaBusquedaAvanzada" style="padding: 2px 2px 2px 6px;">
                    <h5 class="panel-title">
                        <a class="collapsed fuente-seccion" data-toggle="collapse" data-parent="#CriterioBusquedaPostulacion" href="#ColapsaBusquedaAvanzada" aria-expanded="false" aria-controls="ColapsaBusquedaAvanzada">
                            Búsqueda avanzada
                        </a>
                    </h5>
                </div>

                <div id="ColapsaBusquedaAvanzada" class="panel-collapse collapse" role="tabpanel" aria-labelledby="CabeceraColapsaBusquedaAvanzada">
                    <div class="panel-body">
                        <div class="row">
                            <div class="col-sm-4">

                                <div class="input-group fuente-pequeña">

                                    <span class="input-group-addon">Estado</span>
                                    @Html.DropDownListFor(model => model.IdEstadoEmpresa, new SelectList(ViewBag.ListaEstado, "Value", "Text"), "- Seleccionar -", new { @class = "form-control" })

                                </div>

                                <div class="input-group fuente-pequeña">
                                    <span class="input-group-addon">Nombre</span>
                                    @*<input type="text" class="form-control" placeholder="Nombre de la empresa">*@

                                    @Html.TextBoxFor(model => model.NombreComercial, new { @class = "form-control", @placeholder = "Nombre Comercial" ,@id="NombreComercial"})


                                </div>
                                <div class="input-group fuente-pequeña">
                                    <span class="input-group-addon">Razón<br />Social</span>
                                    @*<input type="text" class="form-control" placeholder="Razón Social de la empresa">*@
                                    @Html.TextBoxFor(model => model.RazonSocial, new { @class = "form-control", @placeholder = "Razón Social de la empresa",@id="RazonSocial" })
                                </div>
                            </div>
                            <div class="col-sm-4">
                                @*<div class="input-group fuente-pequeña">
                                        <span class="input-group-addon">RUC</span>
                                        <input type="text" class="form-control" placeholder="Identificador Tributario de la empresa">
                                        @Html.TextBoxFor(model => model.RUC, new { @class = "form-control", @placeholder = "RUC" })
                                    </div>*@
                                <div class="input-group fuente-pequeña">

                                    <span class="input-group-addon">Sector</span>

                                    @Html.DropDownListFor(model => model.IdSector, new SelectList(ViewBag.ListaSector, "Value", "Text"), "- Seleccionar -", new { @class = "form-control" })

                                </div>

                                @*<span class="input-group-addon">Sector</span>
                                        <select id="Lista" class="form-control">
                                            <option value="" selected>Sector empresarial</option>
                                            <option value="1">Auditoría y Consultoría</option>
                                            <option value="1">Banca y Seguros</option>
                                            <option value="1">Construcción e Inmobiliaria</option>
                                            <option value="1">Energía</option>
                                            <option value="1">Industria</option>
                                            <option value="1">Servicios</option>
                                            <option value="1">Tecnología y Software</option>
                                            <option value="1">Telecomunicaciones</option>
                                        </select>

                                    </div>*@
                            </div>

                            <div class="col-sm-4">
                                @*<div class="input-group fuente-pequeña">
                                    <span class="input-group-addon"><input type="checkbox" /></span>
                                    <span class="form-control">Tiene Ofertas activas</span>

                                    @Html.EditorFor(model => model.EstadoOferta)

                                    </div>*@
                                @*<div class="input-group fuente-pequeña">
                                        <span class="input-group-addon"><input type="checkbox" /></span>
                                        <span class="form-control">Tiene Ofertas pendientes de activar</span>
                                    </div>*@
                                <br />

                                <div>
                                    @*<span class="fui" style="font-size:30px;">(</span>*@
                                    <span class="fui" style="font-size:30px;cursor:pointer" id="buscaravanzada">(</span>





                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="resultadobusqueda">
            </div>

        </div>
    </div>
}
@*<script src="~/Scripts/jquery-2.1.1.min.js"></script>*@




<script>

    $(document).ready(function () {
        $("#divFinalCabecera").removeClass("color-paleta1 color-paleta3 color-paleta4 color-paleta5 color-paleta6 color-paleta7 color-paleta8").addClass("color-paleta2");

        AutoCompleteText('#NombreComercial', '@Url.Action("ListarNombreEmpresa", "UTP")', '#NombreComercial');
        AutoCompleteText('#RazonSocial', '@Url.Action("ListarRazonSocial", "UTP")', '#RazonSocial');

    });
    $('#buscar').click(function () {
        var empresa = {
            PalabraClave: $('#PalabraClave').val(),

        };
        Cargar("resultadobusqueda", "/UTP/BusquedaSimpleEmpresasActivas", empresa);


    });
    $(document).ready(function () {
        var empresa = {
            PalabraClave: $('#PalabraClave').val(),

        };
        Cargar("resultadobusqueda", "/UTP/BusquedaSimpleEmpresasActivas", empresa);
    });

    $('#buscaravanzada').click(function () {
        var oferta = {
            NombreComercial: $('#NombreComercial').val(),
            IdEstadoEmpresa: $('#IdEstadoEmpresa').val(),
            IdSector: $('#IdSector').val(),
            RazonSocial: $('#RazonSocial').val(),
            //RUC: $('#RUC').val()
            //,EstadoOferta: $('#OFERAC').val()

        };
        Cargar("resultadobusqueda", "/UTP/BusquedaAvanzadaEmpresas", oferta);
    });

    function Cargar(id, link, entidad) {
        //debugger;
        $.ajax({
            url: link,
            contentType: 'application/json; charset=utf-8',
            type: 'POST',
            data: JSON.stringify(entidad),
            dataType: 'html'
        })
        .success(function (result) {
            $("#" + id).html(result);
            //alert(result);
            //console.log(result);
        })
        .error(function (xhr, status) {
            console.log(xhr);
            console.log(status);
            alert('error');
        })
    }





</script>

<!-- script de Paginacion busqueda simple-->

<script>
    $(document).ready(function () {

        ////Al cargar la página se buscan las ofertas.
        //BusquedaSimpleEmpresasActivas();

        //$("#divFinalCabeceraEmpresa").removeClass("color-paleta1 color-paleta3 color-paleta4 color-paleta5").addClass("color-paleta2");

        $('#btnBuscar').on('click', function () {
            BusquedaSimpleEmpresasActivas();
        });

        function BusquedaSimpleEmpresasActivas() {
            //$('#lblCargandoOfertas').css('visibility', 'visible');

            var palabraClave = $('#filtroBusqueda').val();
            var nroPaginaActual = $('#hddNroPaginaActual').val();

            //Se llama a una accion para buscar las ofertas.
            var url = '@Url.Action("BusquedaSimpleEmpresasActivas", "UTP")' + "?palabraClave=" + palabraClave + '&nroPaginaActual=' + nroPaginaActual;

            $.get(url, function (data) {
                $('#resultadobusqueda').html(data);
            }).then(function () {
                //$('#lblCargandoOfertas').css('visibility', 'hidden');
            });
        }


    });

    //Se le pasa el nro de pagina y hace lo mismo que el anterior.
    function buscarSimpleEmpresasActivas(nroPaginaActual) {
        //$('#lblCargandoOfertas').css('visibility', 'visible');

        var palabraClave = $('#PalabraClave').val();
        //var nroPaginaActual = $('#hddNroPaginaActual').val();

        var url = '@Url.Action("BusquedaSimpleEmpresasActivas", "UTP")' + "?palabraClave=" + palabraClave + '&nroPaginaActual=' + nroPaginaActual;

        $.get(url, function (data) {
            $('#resultadobusqueda').html(data);
        }).then(function () {
            //$('#lblCargandoOfertas').css('visibility', 'hidden');
        });
    }
</script>



<!--Script de paginacion busqueda Avanzada-->

<script>
    $(document).ready(function () {

        ////Al cargar la página se buscan las ofertas.
        //BusquedaSimpleEmpresasActivas();

        //$("#divFinalCabeceraEmpresa").removeClass("color-paleta1 color-paleta3 color-paleta4 color-paleta5").addClass("color-paleta2");

        $('#buscaravanzada').on('click', function () {
            BusquedaAvanzadaEmpresasActivas(1); //Cuando se hace clic en buscar siempre deberia traer la pagina 1, por eso se manda este parametro.
        });


        //Este metodo recibe nroPaginaActual dessde la paginacion.
        //BusquedaAvanzadaEmpresasActivas se utiliza tanto en el buscar como en la paginacion por eso en el buscar se manda 1.
        function BusquedaAvanzadaEmpresasActivas(nroPaginaActual) {
            //$('#lblCargandoOfertas').css('visibility', 'visible');
            //debugger;
            console.log('ingreso');
            var NombreComercial = $('#NombreComercial').val();
            var IdEstadoEmpresa = $('#IdEstadoEmpresa').val();
            var IdSector = $('#IdSector').val();
            var RazonSocial = $('#RazonSocial').val();

            console.log(NombreComercial);
            console.log(IdEstadoEmpresa);
            console.log(IdSector);
            console.log(RazonSocial);
            // este hay que comentarlo, porque no se usa. var nroPaginaActual = $('#nroPaginaActual').val();

            //Se llama a una accion para buscar las ofertas.
            //Aca estas pasando parametros  no entidades
            var url = '@Url.Action("BusquedaAvanzadaEmpresas", "UTP")' + "?NombreComercial=" + NombreComercial + "?IdEstadoEmpresa=" + IdEstadoEmpresa + "?IdSector=" + IdSector + "?RazonSocial=" + RazonSocial + '&nroPaginaActual=' + nroPaginaActual;

            $.get(url, function (data) {
                $('#resultadobusqueda').html(data);
            }).then(function () {
                //$('#lblCargandoOfertas').css('visibility', 'hidden');
            });
        }


    });

    //Se le pasa el nro de pagina y hace lo mismo que el anterior.
    function BusquedaAvanzadaEmpresasActivas(nroPaginaActual) {
        //$('#lblCargandoOfertas').css('visibility', 'visible');

        var NombreComercial = $('#NombreComercial').val();
        var IdEstadoEmpresa = $('#IdEstadoEmpresa').val();
        var IdSector = $('#IdSector').val();
        var RazonSocial = $('#RazonSocial').val();
        var nroPaginaActual = $('#nroPaginaActual').val();
        var url = '@Url.Action("BusquedaAvanzadaEmpresas", "UTP")' + "?NombreComercial=" + NombreComercial + "?IdEstadoEmpresa=" + IdEstadoEmpresa + "?IdSector=" + IdSector + "?RazonSocial=" + RazonSocial + '&nroPaginaActual=' + nroPaginaActual;

        $.get(url, function (data) {
            $('#resultadobusqueda').html(data);
        }).then(function () {
            //$('#lblCargandoOfertas').css('visibility', 'hidden');
        });
    }

</script>
